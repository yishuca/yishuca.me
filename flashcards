<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>darkflip ¬∑ animated flashcards</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: #0b0c0e;
      color: #eaeef2;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    /* main card ‚Äì glassy dark surface */
    .app {
      max-width: 1300px;
      width: 100%;
      background: rgba(18, 22, 28, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(64, 78, 96, 0.3);
      border-radius: 2.5rem;
      padding: 2rem 1.8rem;
      box-shadow: 0 25px 45px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(120, 180, 255, 0.1) inset;
      transition: all 0.3s ease;
    }

    h1, h2 {
      font-weight: 500;
      letter-spacing: -0.02em;
    }

    h1 {
      font-size: 2.4rem;
      background: linear-gradient(130deg, #cad8ff, #b0c4f0);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h1 span {
      font-size: 2rem;
      filter: drop-shadow(0 0 6px #70a0ff);
    }

    .subhead {
      color: #8799b0;
      margin-bottom: 2rem;
      border-left: 3px solid #3d5670;
      padding-left: 1rem;
    }

    /* creator panel ‚Äì fluid cards */
    .creator-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 2.8rem;
      background: rgba(0, 5, 12, 0.35);
      border-radius: 2rem;
      padding: 1.5rem 1.2rem;
      border: 1px solid #263340;
      backdrop-filter: blur(8px);
    }

    .input-group {
      flex: 2 1 260px;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .input-group label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #98b2cd;
      margin-left: 0.5rem;
    }

    .field-row {
      display: flex;
      align-items: center;
      background: #1a212b;
      border-radius: 3rem;
      padding: 0.3rem 0.3rem 0.3rem 1.5rem;
      border: 1px solid #314a62;
      transition: box-shadow 0.2s, border-color 0.2s;
    }

    .field-row:focus-within {
      border-color: #6c9ed9;
      box-shadow: 0 0 0 3px rgba(108, 158, 217, 0.3);
    }

    .field-row input, .field-row select {
      background: transparent;
      border: none;
      color: white;
      font-size: 1rem;
      padding: 0.8rem 0.5rem 0.8rem 0;
      width: 100%;
      outline: none;
    }

    .field-row select option {
      background: #121a24;
    }

    .field-row button {
      background: #314e6b;
      border: none;
      color: white;
      font-weight: 600;
      padding: 0.6rem 1.8rem;
      border-radius: 3rem;
      cursor: pointer;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
      transition: 0.2s;
      border: 1px solid #5779a1;
      box-shadow: 0 4px 12px rgba(0, 20, 40, 0.7);
      white-space: nowrap;
    }

    .field-row button:hover {
      background: #3f6085;
      transform: scale(1.02);
      border-color: #89b9f0;
    }

    .category-selector {
      flex: 1 1 200px;
    }

    /* category pills + delete */
    .category-cloud {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.6rem 1rem;
      margin: 1.5rem 0 2rem 0;
    }

    .cat-badge {
      background: #1b2938;
      padding: 0.5rem 1.2rem 0.5rem 1.8rem;
      border-radius: 3rem;
      font-size: 0.95rem;
      border: 1px solid #3b5b7a;
      display: inline-flex;
      align-items: center;
      gap: 1rem;
      transition: all 0.2s;
      box-shadow: 0 6px 12px -8px black;
      animation: badgePop 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.2);
    }

    @keyframes badgePop {
      0% { opacity: 0; transform: scale(0.7); }
      100% { opacity: 1; transform: scale(1); }
    }

    .cat-badge button {
      background: none;
      border: none;
      color: #b3cde8;
      font-size: 1.4rem;
      line-height: 1;
      cursor: pointer;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.15s;
      background: rgba(255, 70, 70, 0.2);
      color: #ff9f9f;
    }

    .cat-badge button:hover {
      background: #d54545;
      color: white;
      transform: rotate(90deg) scale(1.1);
    }

    /* flashcard grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.2rem;
      margin: 2rem 0 3rem 0;
    }

    /* card design with 3D flip */
    .flip-card {
      background: transparent;
      aspect-ratio: 4 / 3;
      perspective: 2000px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .flip-card:hover {
      transform: translateY(-5px) scale(1.02);
    }

    .flip-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.3, 1);
      transform-style: preserve-3d;
      border-radius: 1.8rem;
      box-shadow: 0 25px 35px -12px black;
    }

    .flipped .flip-inner {
      transform: rotateY(180deg);
    }

    .flip-front, .flip-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      border-radius: 1.8rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      word-break: break-word;
      background: #18222e;
      border: 1px solid #334e6e;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }

    .flip-front {
      background: linear-gradient(145deg, #1d2a38, #131e2b);
    }

    .flip-back {
      background: linear-gradient(145deg, #1a3347, #0f2335);
      transform: rotateY(180deg);
      border-color: #5a80b0;
    }

    .card-category {
      position: absolute;
      top: 8px;
      left: 12px;
      font-size: 0.7rem;
      background: #1d405b;
      padding: 0.2rem 0.8rem;
      border-radius: 20px;
      color: #bedcff;
      border: 1px solid #628bbd;
      z-index: 5;
      pointer-events: none;
    }

    .delete-card-btn {
      position: absolute;
      bottom: 8px;
      right: 10px;
      background: rgba(210, 70, 70, 0.3);
      border: none;
      color: #ffbaba;
      font-size: 1.2rem;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      backdrop-filter: blur(2px);
      transition: all 0.15s;
      border: 1px solid transparent;
    }

    .delete-card-btn:hover {
      background: #c05050;
      color: white;
      transform: scale(1.15) rotate(8deg);
      border-color: white;
    }

    /* test area */
    .test-area {
      background: rgba(10, 18, 28, 0.6);
      border-radius: 2rem;
      padding: 1.8rem 1.5rem;
      border: 1px solid #385;
      margin-top: 1rem;
    }

    .test-header {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 1rem;
    }

    .test-controls {
      display: flex;
      gap: 1rem;
    }

    .primary-btn {
      background: #2a4b6e;
      border: none;
      padding: 0.9rem 2rem;
      border-radius: 3rem;
      font-weight: 600;
      color: white;
      letter-spacing: 0.8px;
      cursor: pointer;
      transition: 0.2s;
      border: 1px solid #679ac4;
      box-shadow: 0 5px 15px rgba(0,30,60,0.8);
    }

    .primary-btn:hover {
      background: #37658f;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px -10px #1d4970;
    }

    .primary-btn:active {
      transform: scale(0.97);
    }

    #quizCard {
      background: #121f2f;
      padding: 2rem;
      border-radius: 2rem;
      margin: 1.8rem 0;
      text-align: center;
      border: 1px solid #456a94;
      box-shadow: inset 0 0 10px #0a141f, 0 12px 28px black;
    }

    .quiz-question {
      font-size: 1.6rem;
      font-weight: 500;
      margin-bottom: 1rem;
    }

    .quiz-answer {
      font-size: 1.8rem;
      color: #cce2ff;
      background: #0d1b2b;
      padding: 1rem;
      border-radius: 2rem;
      border: 1px dashed #6f9fcf;
      margin: 1.5rem 0;
      opacity: 0;
      transition: 0.3s;
    }

    .quiz-answer.show-answer {
      opacity: 1;
    }

    .quiz-feedback {
      display: flex;
      gap: 2rem;
      justify-content: center;
      margin: 1.5rem 0 0.5rem;
    }

    .feedback-btn {
      background: #212e3f;
      border: none;
      font-size: 2.5rem;
      padding: 0.5rem 2rem;
      border-radius: 5rem;
      cursor: pointer;
      transition: 0.2s;
      border: 2px solid transparent;
    }

    .feedback-btn.correct:hover {
      background: #1f5f3a;
      border-color: #6fe381;
      transform: scale(1.1);
      box-shadow: 0 0 20px #41b05e;
    }

    .feedback-btn.wrong:hover {
      background: #962828;
      border-color: #ffa2a2;
      transform: scale(1.1);
      box-shadow: 0 0 20px #d44;
    }

    /* audio-less indicators (web audio fallback) */
    .sound-hint {
      font-size: 0.8rem;
      color: #617e9e;
      margin-top: 0.5rem;
    }

    hr {
      border: 0.5px solid #2d4055;
      margin: 1.2rem 0;
    }

    .empty-message {
      color: #4e6885;
      font-style: italic;
      padding: 2rem;
      text-align: center;
    }

    /* responsive */
    @media (max-width: 550px) {
      .app { padding: 1.5rem 1rem; }
      h1 { font-size: 1.9rem; }
      .field-row { flex-wrap: wrap; background: transparent; padding: 0; }
      .field-row input { background: #1a212b; border-radius: 3rem; padding: 0.8rem 1.5rem; }
      .field-row button { width: 100%; margin-top: 0.5rem; }
    }
  </style>
  <!-- web audio context will be created on first user interaction -->
</head>
<body>
<div class="app">
  <h1><span>‚ö°</span> flip.dark</h1>
  <div class="subhead">create ¬∑ organize ¬∑ test yourself with sound</div>

  <!-- creator -->
  <div class="creator-panel">
    <div class="input-group">
      <label>üìù question</label>
      <div class="field-row">
        <input type="text" id="questionInput" placeholder="" value="">
      </div>
    </div>
    <div class="input-group">
      <label>üí° answer</label>
      <div class="field-row">
        <input type="text" id="answerInput" placeholder="" value="">
      </div>
    </div>
    <div class="input-group category-selector">
      <label>üìÇ category</label>
      <div class="field-row">
        <select id="categorySelect">
          <option value="general">general</option>
        </select>
        <button id="addCategoryBtn">+ new category</button>
      </div>
    </div>
  </div>

  <!-- dynamic category cloud -->
  <div id="categoryList" class="category-cloud"></div>

  <!-- flashcard grid -->
  <h2>üìá your cards ¬∑ <span id="cardCount">0</span></h2>
  <div id="cardsContainer" class="cards-grid"></div>

  <!-- test yourself module -->
  <div class="test-area">
    <div class="test-header">
      <h2>üéØ self test</h2>
      <div class="test-controls">
        <button class="primary-btn" id="startTestBtn">‚ñ∂ start test</button>
        <button class="primary-btn" id="revealAnswerBtn">üîç reveal</button>
      </div>
    </div>
    <div id="quizCard">
      <div class="quiz-question" id="quizQuestion">click start to begin</div>
      <div class="quiz-answer" id="quizAnswer"></div>
      <div class="quiz-feedback" id="quizFeedback">
        <button class="feedback-btn correct" id="correctBtn" disabled>‚úÖ correct</button>
        <button class="feedback-btn wrong" id="wrongBtn" disabled>‚ùå wrong</button>
      </div>
    </div>
    <div class="sound-hint">üîä correct/wrong sounds (tap correct/incorrect)</div>
  </div>
</div>

<script>
  (function() {
    // ---------- data ----------
    let categories = ['general'];
    let cards = [];
    let testSession = [];         // shuffled cards for test
    let currentTestIndex = 0;

    // DOM elements
    const questionInput = document.getElementById('questionInput');
    const answerInput = document.getElementById('answerInput');
    const categorySelect = document.getElementById('categorySelect');
    const addCategoryBtn = document.getElementById('addCategoryBtn');
    const categoryListDiv = document.getElementById('categoryList');
    const cardsContainer = document.getElementById('cardsContainer');
    const cardCountSpan = document.getElementById('cardCount');
    const startTestBtn = document.getElementById('startTestBtn');
    const revealAnswerBtn = document.getElementById('revealAnswerBtn');
    const quizQuestion = document.getElementById('quizQuestion');
    const quizAnswer = document.getElementById('quizAnswer');
    const correctBtn = document.getElementById('correctBtn');
    const wrongBtn = document.getElementById('wrongBtn');

    // ---------- audio context & sounds (init on first user touch) ----------
    let audioCtx = null;
    let correctSound = null;
    let wrongSound = null;

    function initAudio() {
      if (audioCtx) return; // already initialised
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        // correct: nice high ping
        correctSound = (time) => {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.type = 'sine';
          osc.frequency.value = 820;
          gain.gain.setValueAtTime(0.2, time);
          gain.gain.exponentialRampToValueAtTime(0.01, time + 0.3);
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.start(time);
          osc.stop(time + 0.3);
        };
        // wrong: low buzz
        wrongSound = (time) => {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.type = 'sawtooth';
          osc.frequency.value = 220;
          gain.gain.setValueAtTime(0.15, time);
          gain.gain.exponentialRampToValueAtTime(0.01, time + 0.25);
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.start(time);
          osc.stop(time + 0.25);
        };
        // resume if suspended
        if (audioCtx.state === 'suspended') audioCtx.resume();
      } catch (e) { console.warn('audio not supported', e); }
    }

    function playCorrect() {
      initAudio();
      if (audioCtx && correctSound) {
        audioCtx.resume().then(() => correctSound(audioCtx.currentTime));
      }
    }

    function playWrong() {
      initAudio();
      if (audioCtx && wrongSound) {
        audioCtx.resume().then(() => wrongSound(audioCtx.currentTime));
      }
    }

    // ---------- helpers ----------
    function saveToLocal() {
      localStorage.setItem('flashcards_data', JSON.stringify({ categories, cards }));
    }

    function loadFromLocal() {
      const saved = localStorage.getItem('flashcards_data');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          categories = data.categories || ['general'];
          cards = data.cards || [];
        } catch (e) {}
      }
      if (!categories.includes('general')) categories.push('general');
    }

    // render categories cloud
    function renderCategories() {
      let html = '';
      categories.forEach(cat => {
        html += `<div class="cat-badge">üìÅ ${cat} <button class="delete-cat" data-cat="${cat}">‚úï</button></div>`;
      });
      categoryListDiv.innerHTML = html;

      // update select options
      categorySelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');

      // attach delete category (only if not last and not used?)
      document.querySelectorAll('.delete-cat').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const catToDelete = btn.dataset.cat;
          if (catToDelete === 'general') {
            alert('‚ö†Ô∏è general category is protected');
            return;
          }
          // check if cards in this category
          if (cards.some(c => c.category === catToDelete)) {
            if (!confirm(`Category "${catToDelete}" has cards. Delete anyway?`)) return;
          }
          // remove category
          categories = categories.filter(c => c !== catToDelete);
          // also delete all cards of that category? (optional: user may want to keep? we delete to keep consistency)
          cards = cards.filter(c => c.category !== catToDelete);
          renderAll();
          saveToLocal();
        });
      });
    }

    // render flashcard grid
    function renderCards() {
      if (cards.length === 0) {
        cardsContainer.innerHTML = `<div class="empty-message">‚ú® no cards yet ‚Äî create some above</div>`;
        cardCountSpan.innerText = '0';
        return;
      }
      let gridHtml = '';
      cards.forEach((card, idx) => {
        gridHtml += `
          <div class="flip-card" data-card-index="${idx}">
            <div class="flip-inner">
              <div class="flip-front">
                <span class="card-category">${card.category}</span>
                ${card.question}
                <div style="margin-top:0.5rem; font-size:0.7rem; opacity:0.7;">(tap to flip)</div>
              </div>
              <div class="flip-back">
                ${card.answer}
                <button class="delete-card-btn" data-card-idx="${idx}" title="delete card">üóëÔ∏è</button>
              </div>
            </div>
          </div>
        `;
      });
      cardsContainer.innerHTML = gridHtml;
      cardCountSpan.innerText = cards.length;

      // add flip listeners
      document.querySelectorAll('.flip-card').forEach(cardDiv => {
        cardDiv.addEventListener('click', (e) => {
          // avoid flip if delete button clicked
          if (e.target.classList.contains('delete-card-btn')) return;
          cardDiv.classList.toggle('flipped');
        });
      });

      // delete card buttons
      document.querySelectorAll('.delete-card-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const idx = btn.dataset.cardIdx;
          if (idx !== undefined) {
            cards.splice(idx, 1);
            renderAll();
            saveToLocal();
          }
        });
      });
    }

    function renderAll() {
      renderCategories();
      renderCards();
      updateTestButtons();
    }

    // test logic
    function startTest() {
      initAudio(); // preload audio on first test start
      if (cards.length === 0) {
        quizQuestion.innerText = '‚ùå no cards yet';
        quizAnswer.innerText = '';
        quizAnswer.classList.remove('show-answer');
        correctBtn.disabled = true;
        wrongBtn.disabled = true;
        return;
      }
      // shuffle
      testSession = [...cards].sort(() => Math.random() - 0.5);
      currentTestIndex = 0;
      showCurrentTestCard();
      correctBtn.disabled = false;
      wrongBtn.disabled = false;
    }

    function showCurrentTestCard() {
      if (testSession.length === 0 || currentTestIndex >= testSession.length) {
        quizQuestion.innerText = '‚úÖ test finished!';
        quizAnswer.innerText = '';
        quizAnswer.classList.remove('show-answer');
        correctBtn.disabled = true;
        wrongBtn.disabled = true;
        return;
      }
      const card = testSession[currentTestIndex];
      quizQuestion.innerText = `[${card.category}]  ${card.question}`;
      quizAnswer.innerText = card.answer;
      quizAnswer.classList.remove('show-answer');
    }

    function revealAnswer() {
      if (testSession.length && currentTestIndex < testSession.length) {
        quizAnswer.classList.add('show-answer');
      }
    }

    function handleCorrect() {
      if (testSession.length && currentTestIndex < testSession.length) {
        playCorrect();
        // animate feedback
        currentTestIndex++;
        showCurrentTestCard();
      } else {
        playCorrect(); // still play sound for fun
      }
    }

    function handleWrong() {
      playWrong();
      // optional: just sound, but we also reveal answer automatically to help learning?
      if (testSession.length && currentTestIndex < testSession.length) {
        quizAnswer.classList.add('show-answer');
      }
    }

    function updateTestButtons() {
      if (cards.length === 0) {
        correctBtn.disabled = true;
        wrongBtn.disabled = true;
      }
    }

    // add new card
    function addCard() {
      const question = questionInput.value.trim();
      const answer = answerInput.value.trim();
      const category = categorySelect.value;
      if (!question || !answer) {
        alert('fill question and answer');
        return;
      }
      cards.push({ question, answer, category });
      renderAll();
      saveToLocal();
      // clear inputs? keep for next
      questionInput.value = '';
      answerInput.value = '';
    }

    // add category
    function addCategory() {
      const newCat = prompt('enter new category name');
      if (newCat && newCat.trim() && !categories.includes(newCat.trim())) {
        categories.push(newCat.trim());
        renderAll();
        saveToLocal();
      } else if (newCat && categories.includes(newCat.trim())) {
        alert('category exists');
      }
    }

    // ---------- event listeners ----------
    document.addEventListener('click', function firstClickAudio() {
      initAudio();
      document.removeEventListener('click', firstClickAudio);
    }, { once: true });

    addCategoryBtn.addEventListener('click', addCategory);

    // quick add card from input (enter key)
    const addCardHandler = () => addCard();
    document.querySelector('.field-row button')?.addEventListener('click', addCardHandler);

    startTestBtn.addEventListener('click', startTest);
    revealAnswerBtn.addEventListener('click', revealAnswer);
    correctBtn.addEventListener('click', handleCorrect);
    wrongBtn.addEventListener('click', handleWrong);

    // load from storage
    loadFromLocal();
    renderAll();

    // extra: add button for adding card wasn't present? we used the button inside .field-row. but to be safe:
    const existingBtn = document.querySelector('.field-row button');
    if (existingBtn) existingBtn.addEventListener('click', addCardHandler);
    // also allow Enter in inputs
    questionInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCard(); });
    answerInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCard(); });
  })();
</script>
</body>
</html>
