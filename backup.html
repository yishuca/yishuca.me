<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Comfy Cemetery - A dark & cozy blog for eerie tales, gothic comfort, and midnight musings">
    <meta property="og:title" content="The Comfy Cemetery | A Dark & Cozy Blog">
    <meta property="og:description" content="A resting place for dark thoughts, eerie tales, and midnight comfort">
    <meta property="og:type" content="website">
    <title>The Comfy Cemetery | A Dark & Cozy Blog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Shadows+Into+Light&family=Shantell+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:wght@300;400;600&family=Reenie+Beanie&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --dark: #0a0a0a;
            --darker: #050505;
            --accent: #6a0000;
            --light-accent: #8b0000;
            --text: #ffffff;
            --text-light: #ffffff;
            --cozy-gold: #ffffff;
            --main-font: 'Cormorant Garamond', serif;
            --heading-font: 'Cinzel Decorative', serif;
            --nick-font: 'Shadows Into Light', cursive;
            --error-color: #ff4d4d;
            --success-color: #4dff4d;
            --warning-color: #ffcc00;
        }

        [data-theme="forest"] {
            --accent: #1a4d1a;
            --light-accent: #2a6e2a;
            --about-bg-tint: rgba(26, 77, 26, 0.5); /* Dark green tint */
        }

        [data-theme="default"] {
            --about-bg-tint: rgba(106, 0, 0, 0.5); /* Dark red tint */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--main-font);
            color: var(--text);
            overflow-x: hidden;
            line-height: 1.8;
            font-weight: 300;
            background-color: var(--darker);
            transition: all 0.5s ease;
            font-size: clamp(1.2rem, 1.8vw, 1.4rem);
        }

        .about-text p {
            font-size: 1.5rem;
            line-height: 1.6;
        }

        /* Smooth font transitions */
        body, h1, h2, h3, h4, h5, h6, .btn, nav ul li a, .toggle-label, .logo {
            transition: font-family 0.6s cubic-bezier(0.25, 0.1, 0.25, 1), 
                        color 0.5s ease, 
                        background-color 0.5s ease, 
                        border-color 0.5s ease;
        }

        /* Message styling */
        .error-message {
            color: var(--error-color);
            background-color: rgba(139, 0, 0, 0.2);
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid var(--error-color);
            display: none;
        }

        .success-message {
            color: var(--success-color);
            background-color: rgba(0, 100, 0, 0.2);
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid var(--success-color);
            display: none;
        }

        .warning-message {
            color: var(--warning-color);
            background-color: rgba(204, 204, 0, 0.2);
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid var(--warning-color);
            display: none;
        }

        /* Loading states */
        .loading {
            position: relative;
            opacity: 0.7;
            pointer-events: none;
        }

        .loading:after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Video background */
        .video-background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .video-background {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
            transition: opacity 1s ease-in-out;
            filter: brightness(0.5);
        }

        .video-background.active {
            opacity: 1;
            z-index: 1;
        }

        .video-background.inactive {
            opacity: 0;
            z-index: 0;
        }

        .content-container {
            position: relative;
            z-index: 1;
            background-color: transparent;
            width: 100%;
            max-width: 100%;
        }

        section {
            background-color: rgba(10, 10, 10, 0.85);
            padding: clamp(40px, 8vw, 80px) 0;
            border-bottom: 5px solid var(--accent);
            transition: border-color 0.5s ease;
            width: 100vw;
            margin-left: calc(-50vw + 50%);
        }

        /* About section with themed background */
        #about {
            position: relative;
            background-color: rgba(10, 10, 10, 0.7);
        }

        #about::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--about-bg-tint);
            backdrop-filter: blur(5px);
            z-index: -1;
            transition: background 0.5s ease;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--heading-font);
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            letter-spacing: 1px;
        }

        h1 {
            font-size: clamp(2.4rem, 6vw, 4.5rem);
            line-height: 1.2;
        }

        h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            position: relative;
            display: inline-block;
        }

        h2:after {
            content: '';
            position: absolute;
            width: 50%;
            height: 2px;
            background: var(--accent);
            bottom: -10px;
            left: 0;
            transition: background 0.5s ease;
        }

        a {
            color: var(--cozy-gold);
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: clamp(1rem, 1.5vw, 1.1rem);
        }

        a:hover {
            color: var(--light-accent);
        }

        .btn {
            display: inline-block;
            padding: clamp(8px, 2vw, 12px) clamp(15px, 3vw, 30px);
            background-color: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(5px);
            color: var(--text-light);
            border: 2px solid var(--accent);
            border-radius: 0;
            font-family: var(--main-font);
            font-weight: 600;
            font-size: clamp(1rem, 1.5vw, 1.2rem);
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.5s ease;
        }

        .btn:hover {
            background-color: var(--accent);
            color: var(--text-light);
            transform: translateY(-2px);
        }

        #deletePostBtn {
            display: none !important;
        }

        .container {
            width: 100%;
            max-width: min(1400px, 95vw);
            margin: 0 auto;
            padding: 0 clamp(20px, 5vw, 40px);
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 5px 0;
            transition: all 0.3s ease;
            background-color: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(5px);
        }

        header.scrolled {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            padding: 15px 0;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: min(1400px, 95vw);
            margin: 0 auto;
            padding: 0 clamp(20px, 5vw, 40px);
            height: 80px
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2vw, 20px);
        }

        .logo {
            font-family: var(--heading-font);
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 2px;
        }

        .logo span {
            color: var(--accent);
            transition: color 0.5s ease;
        }

        .video-toggle {
            display: flex;
            align-items: center;
            margin-left: clamp(10px, 2vw, 20px);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: clamp(40px, 5vw, 50px);
            height: clamp(20px, 2.5vw, 24px);
            margin: 0 clamp(5px, 1vw, 10px);
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--accent);
            border: .7px solid var(black);
            transition: .5s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: clamp(14px, 2vw, 16px);
            width: clamp(14px, 2vw, 16px);
            left: 4px;
            bottom: 3px;
            background-color: var(--cozy-gold);
            transition: .5s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
            background-color: var(--text-light);
        }

        .toggle-label {
            font-family: var(--main-font);
            font-size: clamp(0.8rem, 1.5vw, 1rem);
            color: var(--text-light);
            white-space: nowrap;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 1001;
            position: relative;
        }

        .hamburger {
            width: 30px;
            height: 3px;
            background: var(--text-light);
            position: relative;
            transition: all 0.3s ease;
        }

        .hamburger:before,
        .hamburger:after {
            content: '';
            position: absolute;
            width: 30px;
            height: 3px;
            background: var(--text-light);
            transition: all 0.3s ease;
        }

        .hamburger:before {
            top: -8px;
        }

        .hamburger:after {
            top: 8px;
        }

        .mobile-menu-btn.active .hamburger {
            background: transparent;
        }

        .mobile-menu-btn.active .hamburger:before {
            top: 0;
            transform: rotate(45deg);
            background: var(--accent);
        }

        .mobile-menu-btn.active .hamburger:after {
            top: 0;
            transform: rotate(-45deg);
            background: var(--accent);
        }

        nav {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 350px;
            height: 100vh;
            background: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(10px);
            padding: 100px 30px 30px;
            transition: all 0.5s cubic-bezier(0.77, 0.2, 0.05, 1);
            z-index: 1000;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        nav.active {
            right: 0;
        }

        nav ul {
            display: flex;
            list-style: none;
            flex-direction: column;
            padding-top: 20px;
        }

        nav ul li {
            margin: 0;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.4s ease;
        }

        nav.active ul li {
            opacity: 1;
            transform: translateX(0);
        }

        nav ul li:nth-child(1) { transition-delay: 0.1s; }
        nav ul li:nth-child(2) { transition-delay: 0.2s; }
        nav ul li:nth-child(3) { transition-delay: 0.3s; }

        nav ul li a {
            display: block;
            padding: 15px 0;
            font-size: clamp(1.2rem, 3vw, 1.4rem);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: var(--main-font);
            font-weight: 600;
            color: var(--text-light);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(2px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .hero {
            height: 100vh;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: transparent;
            width: 100vw;
            margin-left: calc(-50vw + 50%);
        }

        .hero-content {
            max-width: min(800px, 90vw);
            padding: 0 20px;
            width: 100%;
        }

        .hero h1 {
            font-size: clamp(2.4rem, 6vw, 4.5rem);
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s ease-out 0.3s, transform 3.5s ease-out 0.3s;
            text-shadow: 
            2px 2px 1px rgba(0, 0, 0, 0.5);
        }

        .hero h1.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .hero p {
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            margin-bottom: clamp(20px, 4vw, 40px);
            font-weight: 300;
            max-width: min(600px, 90vw);
            margin-left: auto;
            margin-right: auto;
            opacity: 0;
            transition: opacity 1s ease-out 3s, transform 1s ease-out 3s;
            color: var(--text-light);
            text-shadow:
            2px 2px 1px rgba(0, 0, 0, 0.5);
        }

        .hero p.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .hero .btn {
            opacity: 0;
            transition: all 1s ease-out 3.5s, border-color 1s ease, background-color 2s ease;
        }

        .hero .btn.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(350px, 100%), 1fr));
            gap: clamp(20px, 4vw, 40px);
            margin-top: clamp(30px, 5vw, 60px);
            width: 100%;
            justify-content: center;
            justify-items: center;
            padding: 0 clamp(20px, 5vw, 40px);
        }

        .post-card {
            background-color: rgba(20, 20, 20, 0.7);
            border: 1px solid #222;
            transition: all 0.3s ease;
            overflow: hidden;
            will-change: transform;
            width: 100%;
            max-width: 400px;
        }

        .post-card .read-more {
            pointer-events: auto;
        }

        .post-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            border-color: var(--accent);
        }

        .post-image {
            position: relative;
            overflow: hidden;
            height: clamp(200px, 25vw, 250px);
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            transform: translateZ(0) scale(1);
            backface-visibility: hidden;
        }

        .post-image:hover img {
            transform: translateZ(0) scale(1.05);
        }

        .post-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .post-title-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(0);
            width: 100%;
            padding: 0 20px;
            color: white;
            text-align: center;
            font-family: var(--heading-font);
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.8);
            z-index: 2;
            margin: 0;
            backface-visibility: hidden;
            will-change: transform;
        }

        @media (hover: hover) {
            .post-image {
                transition: transform 0.5s ease;
            }
        }

        .post-content h3 {
            display: none;
        }

        .post-content {
            padding-top: 15px;
        }

        .post-card:hover .post-image img {
            transform: scale(1.05);
        }

        .post-content {
            padding: clamp(15px, 3vw, 30px);
            text-align: center;
        }

        .post-meta {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            font-size: clamp(0.9rem, 1.5vw, 1rem);
            color: #999;
            margin-bottom: 15px;
            height: 20px;
        }

        .post-tag {
            display: inline-block;
            padding: clamp(3px, 1vw, 5px) clamp(8px, 2vw, 12px);
            background-color: var(--accent);
            color: var(--text-light);
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
            margin-right: clamp(4px, 1vw, 8px);
            margin-bottom: clamp(4px, 1vw, 8px);
            transition: background-color 0.5s ease;
        }

        .post-excerpt {
            margin: clamp(10px, 2vw, 20px) 0;
            font-size: clamp(1.2rem, 1.8vw, 1.4rem);
            color: var(--text-light);
            text-align: center;
        }

        .read-more {
            display: inline-block;
            margin-top: clamp(10px, 2vw, 15px);
            font-weight: 600;
            color: var(--cozy-gold);
            font-size: clamp(1rem, 1.5vw, 1.1rem);
        }

        .about-content {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: clamp(20px, 4vw, 40px);
            justify-content: center;
            width: 100%;
        }

        .about-text {
            flex: 1;
            min-width: min(300px, 100%);
            padding-right: 0;
            font-size: clamp(1rem, 1.5vw, 1.1rem);
            color: var(--text-light);
            text-align: center;
        }

        .about-image {
            flex: 1;
            min-width: min(300px, 100%);
            position: relative;
            display: flex;
            justify-content: center;
        }

        .about-image img {
            width: 100%;
            max-width: 400px;
            border-radius: 5px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        footer {
            padding: clamp(40px, 8vw, 80px) 0 0;
            text-align: center;
            transition: border-color 0.5s ease;
            position: relative;
            background-color: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(5px);
            width: 100vw;
            margin-left: calc(-50vw + 50%);
        }

        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 0px;
            gap: clamp(20px, 4vw, 40px);
            width: 100%;
            padding-bottom: clamp(20px, 4vw, 30px);
        }

        .footer-column {
            flex: 1;
            min-width: min(250px, 100%);
            margin-bottom: clamp(20px, 4vw, 40px);
            text-align: center;
        }

        .footer-column h3 {
            margin-bottom: clamp(15px, 3vw, 25px);
            position: relative;
            display: inline-block;
        }

        .footer-column h3:after {
            content: '';
            position: absolute;
            width: 40px;
            height: 2px;
            background: var(--accent);
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            transition: background 0.5s ease;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: clamp(8px, 1.5vw, 12px);
        }

        .footer-links a {
            color: var(--text);
            transition: all 0.3s ease;
            font-size: clamp(1rem, 1.5vw, 1.1rem);
        }

        .footer-links a:hover {
            color: var(--cozy-gold);
            padding-left: 5px;
        }

        .copyright {
            border-top: 5px solid #333;
            padding: clamp(15px, 3vw, 30px) 0;
            font-size: clamp(0.9rem, 1.5vw, 1rem);
            color: #777;
            text-align: center;
            width: 100%;
            margin: 0;
        }

        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #c00;
        }

        .preloader-text {
            font-size: clamp(1.2rem, 4vw, 2.5rem);
            text-transform: uppercase;
            letter-spacing: 0.3rem;
            text-align: center;
            text-shadow: 0 0 30px rgb(179, 0, 0), 0 0 20px #600;
            margin: 0 1rem 2rem;
            position: relative;
            animation: textPulse 2s infinite alternate;
            padding: 50px;
            font-weight:bold;
        }

        .blood-drop {
            width: clamp(60px, 15vw, 100px);
            height: clamp(60px, 15vw, 100px);
            animation: drip 3s infinite, dropPulse 2s infinite alternate;
            filter: drop-shadow(0 0 10px #800);
        }

        .blood-drop path {
            fill: #c00;
        }

        .loading-bar {
            width: min(80%, 300px);
            height: 4px;
            background: #300;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            border-radius: 2px;
        }

        .loading-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #600, #c00, #600);
            animation: loading 3s forwards;
        }

        .gif-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            pointer-events: none;
            display: none;
            filter: brightness(0%);
        }

        .gif-tile {
            position: absolute;
            background-size: cover;
            background-position: center;
            transition: all 2.5s cubic-bezier(0.2, 0.8, 0.4, 1);
            transform-origin: center;
            will-change: transform;
            opacity: 1 !important;
        }

        .content {
            opacity: 0;
            transition: opacity 0.5s ease-out;
            padding: 20px;
            position: relative;
            z-index: 1;
            text-align: center;
            color: #c00;
        }

        .content.visible {
            opacity: 1;
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes textPulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.05); opacity: 1; }
        }

        @keyframes dropPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        @keyframes drip {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(10px); }
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .admin-btn {
            width: 50px;
            height: 50px;
            background-color: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(5px);
            color: var(--cozy-gold);
            border: 2px solid var(--accent);
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .admin-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            background-color: var(--accent);
            color: var(--text-light);
        }

        .admin-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .admin-panel-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .admin-panel-expanded {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 2001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .admin-panel-expanded.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .admin-form h3 {
            color: var(--cozy-gold);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .admin-form label {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: -10px;
        }

        .admin-form input, 
        .admin-form textarea, 
        .admin-form select {
            padding: 12px;
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            color: white;
            font-family: var(--main-font);
            font-size: 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .admin-form input:focus, 
        .admin-form textarea:focus, 
        .admin-form select:focus {
            border-color: var(--accent);
        }

        .admin-form textarea {
            min-height: 200px;
            resize: vertical;
        }

        .admin-form .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .admin-form button {
            padding: 12px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--main-font);
            font-weight: 600;
            font-size: 1rem;
        }

        .admin-form button:hover {
            background-color: var(--light-accent);
            transform: translateY(-2px);
        }

        .admin-form button.secondary {
            background-color: transparent;
            border: 1px solid #444;
        }

        .admin-form button.secondary:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-color: #666;
        }

        .admin-form button.danger {
            background-color: #8b0000;
        }

        .admin-form button.danger:hover {
            background-color: #a00000;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 25px;
            background-color: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--accent);
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .login-form h3 {
            color: var(--cozy-gold);
            text-align: center;
            margin-bottom: 20px;
        }

        .login-form input {
            padding: 12px;
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            color: white;
            font-family: var(--main-font);
            border-radius: 4px;
        }

        .login-form button {
            padding: 12px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--main-font);
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .login-form button:hover {
            background-color: var(--light-accent);
        }

        .hidden {
            display: none;
        }

        .posts-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .posts-list th {
            padding: 12px 15px;
            text-align: left;
            background-color: rgba(138, 0, 0, 0.2);
            color: var(--cozy-gold);
            font-family: var(--heading-font);
        }

        .posts-list td {
            padding: 12px 15px;
            text-align: left;
        }

        .posts-list tr:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }

        .post-actions {
            display: flex;
            gap: 8px;
        }

        .post-actions button {
            padding: 6px 10px;
            font-size: 0.9rem;
            border-radius: 3px;
        }

        /* Loading spinner for posts */
        .posts-loading {
            display: none;
            text-align: center;
            padding: 20px;
            grid-column: 1 / -1;
        }

        .posts-loading.active {
            display: block;
        }

        /* Single post view */
        .single-post {
            display: none;
            width: 100vw;
            position: relative;
            top: 0;
            padding-top: 460px;
            margin-left: calc(-50vw + 50%);
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }
        
        /* Single post loading state */
        .single-post.loading {
            min-height: 60vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .single-post.loading::after {
            content: "";
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        .single-post.active {
            display: block;
        }

        #singlePostView {
            position: relative;
            background: transparent;
            padding-top: 20px;
            margin-top: 70px;
        }

        #singlePostView::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(3px);
            z-index: -1;
        }

        #singlePostView .container {
            position: relative;
            max-width: min(1000px, 90vw);
            padding-top: 70;
        }

        body.single-post-active {
            padding-top: 0;
            margin-top: 0;
        }

        body.single-post-active .content-container {
            padding-top: 0;
        }

        /* Sticky Back Button */
        .back-to-blog {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 12px 20px;
            background-color: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(5px);
            color: var(--cozy-gold);
            border: 2px solid var(--accent);
            border-radius: 50px;
            font-family: var(--main-font);
            font-weight: 600;
            font-size: 1rem;
            z-index: 100;
            transition: all 0.3s ease;
            text-decoration: none;
            display: none;
        }

        .back-to-blog.visible {
            display: block;
        }

        .back-to-blog:hover {
            background-color: var(--accent);
            color: var(--text-light);
            transform: translateY(-2px);
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            background-color: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(5px);
            color: var(--cozy-gold);
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 99;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background-color: var(--accent);
            color: var(--text-light);
            transform: translateX(-50%) translateY(-4px);
        }

        /* Blurred background for Latest Epitaphs */
        #blog {
            position: relative;
            background: transparent;
            border-bottom: 5px solid var(--accent);
        }

        #blog::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(0px);
            z-index: -1;
        }

        .single-post .post-image {
            height: 400px;
            margin: 60px 0;
            border-radius: 5px;
            overflow: hidden;
        }

        .single-post .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .single-post .post-content {
            text-align: left;
            padding: 0;
        }

        .single-post .post-meta {
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .single-post .post-tags {
            margin-bottom: 0px;
        }

        .single-post .post-content-text {
            color: var(--text-light);
            font-size: 1.6rem;
            line-height: 1.8;
            white-space: pre-wrap;
            max-width: 800px;
            margin: 0 auto;
        }

        .single-post .post-content-text p {
            margin-bottom: 1.5rem;
            text-indent: 2em;
        }

        .single-post .post-content-text h1 {
            font-size: 1.8rem;
            margin: 2.5rem 0 1.5rem;
            color: var(--cozy-gold);
        }

        .single-post .post-content-text h2 {
            font-size: 1.6rem;
            margin: 2rem 0 1rem;
            color: var(--cozy-gold);
        }

        .single-post .post-content-text h3 {
            font-size: 1.4rem;
            margin: 1.8rem 0 0.8rem;
            color: var(--cozy-gold);
        }

        .single-post .post-content-text a {
            color: var(--accent);
            text-decoration: underline;
        }

        .single-post .post-content-text a:hover {
            color: var(--light-accent);
        }

        /* Rich text formatting */
        .single-post .post-content-text strong,
        .single-post .post-content-text b {
            font-weight: 600;
            color: var(--cozy-gold);
        }

        .single-post .post-content-text em,
        .single-post .post-content-text i {
            font-style: italic;
        }

        .single-post .post-content-text u {
            text-decoration: underline;
        }

        .single-post .post-content-text blockquote {
            border-left: 3px solid var(--accent);
            padding-left: 20px;
            margin: 1.5rem 0;
            font-style: italic;
            color: #ccc;
        }

        .single-post .post-content-text ul,
        .single-post .post-content-text ol {
            margin: 1.5rem 0;
            padding-left: 30px;
        }

        .single-post .post-content-text li {
            margin-bottom: 0.5rem;
        }

        /* Text alignment classes */
        .single-post .post-content-text .text-left {
            text-align: left;
        }

        .single-post .post-content-text .text-center {
            text-align: center;
        }

        .single-post .post-content-text .text-right {
            text-align: right;
        }

        .single-post .post-content-text .text-justify {
            text-align: justify;
        }

        /* Formatting toolbar styles */
        .formatting-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: rgba(20, 20, 20, 0.8);
            border-radius: 4px;
            position: relative;
            z-index: 1;
        }

        .formatting-button {
            padding: 5px 10px;
            background-color: rgba(30, 30, 30, 0.8);
            border: 1px solid #444;
            color: white;
            cursor: pointer;
            border-radius: 3px;
            font-family: var(--main-font);
            transition: all 0.2s ease;
        }

        .formatting-button:hover {
            background-color: rgba(50, 50, 50, 0.8);
        }

        .formatting-button.active {
            background-color: var(--accent);
            border-color: var(--light-accent);
        }

        .alignment-picker {
            position: relative;
            display: inline-block;
        }

        .alignment-options {
            position: absolute;
            bottom: 100%;
            left: 0;
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            background-color: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-radius: 4px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .alignment-option {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 3px;
            background-color: rgba(30, 30, 30, 0.8);
        }

        .alignment-option:hover {
            background-color: rgba(50, 50, 50, 0.8);
        }

        .size-picker {
            position: relative;
            display: inline-block;
        }

        .size-options {
            position: absolute;
            bottom: 100%;
            left: 0;
            display: none;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
            background-color: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-radius: 4px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .size-option {
            padding: 5px 10px;
            background-color: rgba(30, 30, 30, 0.8);
            border-radius: 3px;
            cursor: pointer;
        }

        .size-option:hover {
            background-color: rgba(50, 50, 50, 0.8);
        }

        /* Content Editable Styles */
        #postContentEditor {
            min-height: 200px;
            padding: 12px;
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            color: white;
            font-family: var(--main-font);
            font-size: 1rem;
            border-radius: 4px;
            outline: none;
        }

        #postContentEditor:focus {
            border-color: var(--accent);
        }

        #postContentEditor p {
            margin-bottom: 1rem;
            text-indent: 2em;
        }

        /* Alignment styles for editor and display */
        .text-left, [align="left"] {
            text-align: left;
        }
        
        .text-center, [align="center"] {
            text-align: center;
        }
        
        .text-right, [align="right"] {
            text-align: right;
        }
        
        .text-justify, [align="justify"] {
            text-align: justify;
        }

        /* Extra large screens */
        @media (min-width: 2000px) {
            .container, .header-container {
                max-width: 1600px;
            }
            
            section {
                padding: 100px 0;
            }
            
            .hero h1 {
                font-size: 5rem;
            }
            
            .hero p {
                font-size: 2rem;
            }

            .single-post .post-content-text {
                max-width: 900px;
            }
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .video-toggle {
                display: flex;
                margin-left: 10px;
            }

            .toggle-label {
                font-size: 0.9rem;
                white-space: normal;
                line-height: 1.2;
                text-align: center;
                width: 60px;
            }

            header.active {
                padding-right: 70px;
            }

            .hero h1 {
                font-size: 2.8rem;
            }

            .hero p {
                font-size: 1.4rem;
            }

            .about-text, .about-image {
                flex: 100%;
            }

            .about-text {
                padding-right: 0;
                margin-bottom: 40px;
            }

            .nav-right {
                gap: 10px;
            }

            .admin-panel-expanded {
                width: 95%;
                padding: 15px;
            }

            .posts-list {
                display: block;
                overflow-x: auto;
            }

            .single-post {
                margin-top: 70px;
            }

            .single-post .post-image {
                height: 300px;
                margin: 30px 0;
            }

            .single-post .post-content-text {
                font-size: 1.5rem;
            }

            .single-post .post-content-text h1 {
                font-size: 1.6rem;
            }

            .single-post .post-content-text h2 {
                font-size: 1.4rem;
            }

            .single-post .post-content-text h3 {
                font-size: 1.2rem;
            }

            .formatting-toolbar {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding: 8px;
            }

            .back-to-blog {
                bottom: 20px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            body {
                font-size: 1.5rem;
            }

            .hero h1 {
                font-size: 2.4rem;
            }

            section {
                padding: 60px 0;
            }

            .footer-column {
                flex: 100%;
                text-align: center;
            }

            .footer-column h3:after {
                left: 50%;
                transform: translateX(-50%);
            }

            .video-toggle {
                flex-direction: column;
                align-items: center;
                gap: 5px;
            }

            .toggle-label {
                width: auto;
            }

            .post-actions {
                flex-direction: column;
            }

            .single-post {
                padding: 20px 15px;
                margin-top: 95px;
            }

            .single-post .post-image {
                height: 200px;
                margin: 20px 0;
            }

            .single-post .post-content-text {
                font-size: 1.5rem;
            }

            .single-post .post-content-text h1 {
                font-size: 1.5rem;
            }

            .single-post .post-content-text h2 {
                font-size: 1.3rem;
            }

            .single-post .post-content-text h3 {
                font-size: 1.1rem;
            }
        }

        /* Hide sections when single post is active */
        body.single-post-active #home,
        body.single-post-active #blog,
        body.single-post-active #about {
            display: none;
        }

        body.single-post-active footer {
            display: block;
        }
    </style>
</head>
<body>
    <div class="preloader" id="preloader">
        <div class="preloader-text" id="preloaderText"></div>
        <svg class="blood-drop" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <path d="M16.464 2.516c-1.856 10.786-7.379 12.959-7.379 20.521 0 3.794 3.751 6.583 7.379 6.583v0c3.71 0 7.234-2.608 7.234-6.21 0-7.259-5.316-10.128-7.234-20.894zM12.827 16.064h0c-1.745 4.713-0.319 9.644 3.385 11.192 0.948 0.396 1.978 0.482 2.988 0.392-7.246 3.107-11.594-4.98-6.373-11.585z"/>
        </svg>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>
    <div class="gif-container" id="gifContainer"></div>
    <div class="content" id="mainContent">
        <!-- Fixed Video Backgrounds -->
        <div class="video-background-container">
            <video class="video-background active" id="video1" autoplay muted loop playsinline webkit-playsinline preload="auto">
                <source src="./vid1.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <video class="video-background inactive" id="video2" autoplay muted loop playsinline webkit-playsinline preload="none">
                <source src="./vid2.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>

        <!-- Main Content Container -->
        <div class="content-container">
            <!-- Header -->
            <header id="header">
                <div class="header-container">
                    <a href="#" class="logo">THE COMFY <span>CEMETERY</span></a>
                    <div class="nav-right">
                        <div class="video-toggle">
                            <span class="toggle-label">Karime</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="videoToggle">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">Nick</span>
                        </div>
                        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation menu">
                            <span class="hamburger"></span>
                        </button>
                    </div>
                    <nav id="nav">
                        <ul>
                            <li><a href="#home">Home</a></li>
                            <li><a href="#blog">Blog</a></li>
                            <li><a href="#about">About</a></li>
                        </ul>
                    </nav>
                    <div class="menu-overlay" id="menuOverlay"></div>
                </div>
            </header>
            
            <!-- Hero Section -->
            <section class="hero" id="home">
                <div class="hero-content">
                    <h1 id="main-title">Welcome to The Comfy Cemetery</h1>
                    <p id="subtitle">A cozy corner for dark thoughts, eerie tales, and midnight musings.</p>
                    <a href="#blog" class="btn" id="cta-button">Enter if you dare.</a>
                </div>
            </section>

            <!-- Blog Posts Section -->
            <section id="blog">
                <div class="container">
                    <h2>Latest Epitaphs</h2>
                    <div class="posts-grid" id="postsGrid">
                        <!-- Posts will be loaded dynamically -->
                    </div>
                    <div class="posts-loading" id="postsLoading">
                        <div class="loading"></div>
                    </div>
                </div>
            </section>

            <!-- Single Post View (hidden by default) -->
            <section id="singlePostView" class="single-post">
                <div class="container">
                    <article id="singlePostContent">
                        <!-- Single post content will be loaded here -->
                    </article>
                </div>
            </section>

            <!-- Sticky Back Button -->
            <a href="#blog" class="back-to-blog" id="backToBlog"> Back to all posts</a>

            <!-- Back to Top Button -->
            <button class="back-to-top" id="backToTop" aria-label="Back to top"></button>

            <!-- About Section -->
            <section id="about">
                <div class="container">
                    <h2>Karime: The One, The Only, The Absolutely Unforgettable</h2>
                    <div class="about-content">
                        <div class="about-text">
                            <p>Okay, let's be realI'm kind of amazing. Not to brag (okay, maybe a little), but I bring the perfect mix of charm, humor, and just the right amount of chaos to keep life interesting.</p>
                            <br>
                            <a href="#about" class="btn">My Full Story</a>
                        </div>
                        <div class="about-image">
                            <img src="https://i.pinimg.com/736x/6a/db/5c/6adb5c9bb9aa994a04e19e13d54966fb.jpg" alt="Karime - The creator of The Comfy Cemetery" loading="lazy">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer>
                <div class="container">
                    <div class="footer-content">
                        <div class="footer-column">
                            <h3>The Comfy Cemetery</h3>
                            <p>A resting place for dark thoughts, eerie tales, and midnight comfort.</p>
                        </div>
                        <div class="footer-column">
                            <h3>Explore</h3>
                            <ul class="footer-links">
                                <li><a href="#home">Home</a></li>
                                <li><a href="#blog">Blog</a></li>
                                <li><a href="#about">About</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="copyright">
                        <p>&copy; 2023 The Comfy Cemetery. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <button class="admin-btn" id="adminToggleBtn"></button>
        <div class="admin-panel-overlay" id="adminPanelOverlay"></div>
        <div class="admin-panel-expanded" id="adminPanelExpanded">
            <div id="loginForm" class="login-form">
                <h3>Admin Login</h3>
                <div id="loginError" class="error-message"></div>
                <input type="email" id="adminEmail" placeholder="Email">
                <input type="password" id="adminPassword" placeholder="Password">
                <button id="loginBtn">Login</button>
            </div>
            <div id="adminControls" class="hidden">
                <h3>Admin Controls</h3>
                <div id="adminError" class="error-message"></div>
                <div id="adminSuccess" class="success-message"></div>
                
                <div id="postsListContainer" class="hidden">
                    <h4>Manage Posts</h4>
                    <div class="form-actions">
                        <button id="addPostBtn" class="btn">Add New Post</button>
                    </div>
                    <table class="posts-list">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="postsList">
                            <!-- Posts will be loaded here -->
                        </tbody>
                    </table>
                    <br>
                    <button id="logoutBtn" class="btn secondary">Logout</button>
                </div>
                
                <div id="postForm" class="admin-form hidden">
                    <h3 id="formTitle">Create New Post</h3>
                    <div id="postFormError" class="error-message"></div>
                    <input type="hidden" id="postId">
                    <label for="postTitle">Title</label>
                    <input type="text" id="postTitle" placeholder="Post Title">
                    <label for="postContent">Content</label>
                    <div class="formatting-toolbar" id="formattingToolbar">
                        <button type="button" class="formatting-button" data-command="bold" title="Bold"><strong>B</strong></button>
                        <button type="button" class="formatting-button" data-command="italic" title="Italic"><em>I</em></button>
                        <button type="button" class="formatting-button" data-command="underline" title="Underline"><u>U</u></button>
                        
                        <div class="alignment-picker">
                            <button type="button" class="formatting-button" id="alignmentPickerBtn">Align</button>
                            <div class="alignment-options" id="alignmentOptions">
                                <div class="alignment-option" data-align="left" title="Left align">L</div>
                                <div class="alignment-option" data-align="center" title="Center align">C</div>
                                <div class="alignment-option" data-align="right" title="Right align">R</div>
                                <div class="alignment-option" data-align="justify" title="Justify">J</div>
                            </div>
                        </div>
                        
                        <div class="size-picker">
                            <button type="button" class="formatting-button" id="sizePickerBtn">Size</button>
                            <div class="size-options" id="sizeOptions">
                                <div class="size-option" data-size="xs">Extra Small</div>
                                <div class="size-option" data-size="sm">Small</div>
                                <div class="size-option" data-size="md">Medium</div>
                                <div class="size-option" data-size="lg">Large</div>
                                <div class="size-option" data-size="xl">Extra Large</div>
                                <div class="size-option" data-size="xxl">XX Large</div>
                            </div>
                        </div>
                    </div>
                    <div id="postContentEditor" contenteditable="true"></div>
                    <input type="hidden" id="postContent">
                    <label for="postImage">Image URL</label>
                    <input type="text" id="postImage" placeholder="Image URL">
                    <label for="postTags">Tags (comma separated)</label>
                    <input type="text" id="postTags" placeholder="Tags (comma separated)">
                    <div class="form-actions">
                        <button id="savePostBtn" class="btn">Save Post</button>
                        <button id="cancelPostBtn" class="btn secondary">Cancel</button>
                        <button id="deletePostBtn" class="btn danger" style="display: none;">Delete Post</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ======================
        // Firebase Configuration
        // ======================
        const firebaseConfig = {
            apiKey: "AIzaSyDB56BEg05CryAgi0FJyteide8mnSycFHU",
            authDomain: "thecomfycemetery.firebaseapp.com",
            projectId: "thecomfycemetery",
            storageBucket: "thecomfycemetery.appspot.com",
            messagingSenderId: "860660738178",
            appId: "1:860660738178:web:a26913b7f1e07d8e79ec9b"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ======================
        // Constants & Config
        // ======================
        const CONFIG = {
            preloader: {
                minLoadTime: 3000,
                tileCount: 32,
                cols: 8,
                messages: [
                    "Polishing the headstones...",
                    "This delay is killer...",
                    "Putting the 'fun' in funeral...",
                    "Chanting forbidden verses...",
                    "Death is patient. Are you?...",
                    "You're alive to see this? Lucky...",
                    "Raising this page from the dead...",
                    "Sweeping the cobwebs off your page...",
                    "Digging up your content...",
                    "Summoning ancient spirits...",
                    "Brewing the dark elixir...",
                    "Carving the pentagram...",
                    "Awakening the undead...",
                    "Conjuring the shadows...",
                    "Preparing the sacrificial altar...",
                    "The skeleton crew is on strike for better bandwidth...",  
                    "Bribing the cemetery raccoons to run the server...",  
                    "Loading... or is this a government afterlife simulation?",  
                    "We'd load faster, but the office ouija board keeps spelling 'NOPE.'",  
                    "This is definitely not a screensaver for the underworld.",  
                    "100% not haunted. Promise.",  
                    "This delay is training you for eternity.",
                    "Unrolling the blood-red carpet...",
                    "Waiting for the skeleton crew to wake up...",
                    "Finding a spot for you in the graveyard...",
                    "Fluffing the cobwebs...",
                    "Warming up the tomb...",
                    "The loading bar is haunted (it moves on its own)",
                    "The end is near... of this loading screen",
                    "3% alive, 97% undead, 100% loading...",
                    "Entering the cemetery... watch your step",
                    "Loading because eternity takes time.",
                    "Processing just like grief.",
                    "Just a few more moments... then you'll be dead set on our site.",
                    "We're exhuming the data... almost there.",
                    "We're just dying to show you our site.",
                    "Nick's the kind of guy who brings a ladder to a bar and says, 'Drinks are on the house!'",
                    "Nick's so good at procrastinating, he puts off finishing his... well, you get the idea.",
                    "Karime's the reason 'hangry' was added to the dictionary.",
                    "Karime: Tiktok Meme connoisseur.",
                    "Karime's spice rack is just various shades of black pepper.",
                    "Karime's garden is mostly just shade. And ravens.",
                    "Karime's favorite color is 'the absence of light.'",
                    "Karime's idea of a sunny day is when the clouds are a slightly lighter shade of grey.",
                    "Karime's happy place is a bookstore that smells like old paper and despair... in a good way.",
                    "Karime's idea of 'Netflix and chill' is watching classic horror films with the curtains drawn at noon.",
                    "Karime's travel destinations include Transylvania, Salem, and any city with a well-preserved cemetery.",
                    "Nick's superpower is starting projects. His kryptonite is finishing them.",
                    "Nick's idea of 'being on time' is arriving precisely when he remembers he was supposed to be somewhere.",
                    "Nick's spirit animal is a question mark.",
                    "Nick's dreams are apparently used as inspiration for modern art exhibits.",
                    "Nick's awesomeness is so bright, it needs its own sunglasses.",
                    "Nick's awesomeness is the reason we believe in humanity.",
                    "Nick's awesomeness is a superpower disguised as a regular human.",
                    "Nick's awesomeness is so intense, it creates a localized field of pure good vibes.",
                    "Karime doesn't chase cool, cool chases Karime.",
                    "Karime's coolness is like a well-worn leather jacket: it just gets better with time.",
                    "Karime's coolness is a natural phenomenon, like a perfectly timed sunset.",
                    "Nick's brain is like a search engine with questionable filters.",
                    "Nick's sense of direction is so bad, he gets lost in his own train of thought.",
                ]
            },
            videos: {
                video1: "./vid1.mp4",
                video2: "./vid2.mp4",
                fallbackImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23050505'/%3E%3Ctext x='50%' y='50%' fill='%23ffffff' font-family='Cormorant Garamond' font-size='24' text-anchor='middle'%3EVideo not loaded%3C/text%3E%3C/svg%3E"
            },
            posts: {
                perPage: 6,
                loadThreshold: 300
            }
        };

        // ======================
        // DOM Elements
        // ======================
        const dom = {
            // Preloader
            preloader: document.getElementById('preloader'),
            preloaderText: document.getElementById('preloaderText'),
            gifContainer: document.getElementById('gifContainer'),
            
            // Video
            videoToggle: document.getElementById('videoToggle'),
            video1: document.getElementById('video1'),
            video2: document.getElementById('video2'),
            
            // Navigation
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            nav: document.getElementById('nav'),
            menuOverlay: document.getElementById('menuOverlay'),
            header: document.getElementById('header'),
            
            // Content
            mainContent: document.getElementById('mainContent'),
            mainTitle: document.getElementById('main-title'),
            subtitle: document.getElementById('subtitle'),
            ctaButton: document.getElementById('cta-button'),
            postsGrid: document.getElementById('postsGrid'),
            postsLoading: document.getElementById('postsLoading'),
            singlePostView: document.getElementById('singlePostView'),
            singlePostContent: document.getElementById('singlePostContent'),
            backToBlog: document.getElementById('backToBlog'),
            backToTop: document.getElementById('backToTop'),
            
            // Admin Panel
            adminPanel: document.getElementById('adminPanel'),
            adminToggleBtn: document.getElementById('adminToggleBtn'),
            adminPanelOverlay: document.getElementById('adminPanelOverlay'),
            adminPanelExpanded: document.getElementById('adminPanelExpanded'),
            loginForm: document.getElementById('loginForm'),
            loginError: document.getElementById('loginError'),
            adminControls: document.getElementById('adminControls'),
            adminError: document.getElementById('adminError'),
            adminSuccess: document.getElementById('adminSuccess'),
            adminEmail: document.getElementById('adminEmail'),
            adminPassword: document.getElementById('adminPassword'),
            loginBtn: document.getElementById('loginBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            addPostBtn: document.getElementById('addPostBtn'),
            postsListContainer: document.getElementById('postsListContainer'),
            postsList: document.getElementById('postsList'),
            postForm: document.getElementById('postForm'),
            postFormError: document.getElementById('postFormError'),
            formTitle: document.getElementById('formTitle'),
            postId: document.getElementById('postId'),
            postTitle: document.getElementById('postTitle'),
            postContent: document.getElementById('postContent'),
            postContentEditor: document.getElementById('postContentEditor'),
            postImage: document.getElementById('postImage'),
            postTags: document.getElementById('postTags'),
            savePostBtn: document.getElementById('savePostBtn'),
            cancelPostBtn: document.getElementById('cancelPostBtn'),
            deletePostBtn: document.getElementById('deletePostBtn'),
            
            // Formatting toolbar
            formattingToolbar: document.getElementById('formattingToolbar'),
            alignmentPickerBtn: document.getElementById('alignmentPickerBtn'),
            alignmentOptions: document.getElementById('alignmentOptions'),
            sizePickerBtn: document.getElementById('sizePickerBtn'),
            sizeOptions: document.getElementById('sizeOptions')
        };

        // ======================
        // State Management
        // ======================
        const state = {
            posts: [],
            lastVisiblePost: null,
            hasMorePosts: true,
            isLoadingPosts: false,
            currentPost: null
        };

        // ======================
        // Utility Functions
        // ======================
        const utils = {
            showError(element, message) {
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            },
            
            showSuccess(element, message) {
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            },
            
            formatDate(date) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            },
            
            sanitizeInput(input) {
                return input.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            },
            
            scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            },
            
            scrollToElement(element, offset = 100) {
                const elementPosition = element.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - offset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            },
            
            setLoading(element, isLoading) {
                if (isLoading) {
                    element.classList.add('loading');
                } else {
                    element.classList.remove('loading');
                }
            },
            
            formatText(command, value = null) {
                document.execCommand(command, false, value);
                dom.postContentEditor.focus();
            },
            
            toggleFormattingButton(button) {
                button.classList.toggle('active');
            }
        };

        // ======================
        // Core Modules
        // ======================

        // 1. Preloader Module
        const preloader = {
            init() {
                this.setRandomMessage();
                this.startLoadSequence();
            },
            
            setRandomMessage() {
                const messages = CONFIG.preloader.messages;
                dom.preloaderText.textContent = messages[Math.floor(Math.random() * messages.length)];
            },
            
            startLoadSequence() {
                const startTime = Date.now();
                const loaderImg = new Image();
                loaderImg.src = 'https://cdna.artstation.com/p/assets/images/images/012/951/896/original/ian-berghuijs-flying-bat.gif?1537343287';
                
                // Set up video error handlers
                this.setupVideoFallbacks();
                
                Promise.all([
                    new Promise(resolve => loaderImg.onload = resolve),
                    new Promise(resolve => document.fonts.ready.then(resolve)),
                    new Promise(resolve => setTimeout(resolve, CONFIG.preloader.minLoadTime))
                ]).then(() => {
                    this.hidePreloader();
                    this.animateGifTiles(loaderImg.src);
                    this.showHeroContent();
                }).catch(error => {
                    console.error("Preloader error:", error);
                    this.hidePreloader();
                });
            },
            
            setupVideoFallbacks() {
                [dom.video1, dom.video2].forEach(video => {
                    video.addEventListener('error', () => {
                        console.error(`Video ${video.id} failed to load`);
                        video.style.display = 'none';
                        video.parentElement.style.background = `url('${CONFIG.videos.fallbackImage}') center/cover`;
                    });
                });
            },
            
            hidePreloader() {
                dom.preloader.style.opacity = '0';
                setTimeout(() => {
                    dom.preloader.style.display = 'none';
                }, 500);
            },
            
            animateGifTiles(gifUrl) {
                dom.gifContainer.style.display = 'block';
                const { tileCount, cols } = CONFIG.preloader;
                const rows = Math.ceil(tileCount / cols);
                
                for (let i = 0; i < tileCount; i++) {
                    const tile = document.createElement('div');
                    tile.className = 'gif-tile';
                    tile.style.backgroundImage = `url('${gifUrl}')`;
                    tile.style.willChange = 'transform';
                    
                    const startRot = -45 + Math.random() * 90;
                    const startSize = Math.max(
                        window.innerWidth * (0.5 + Math.random() * 0.3),
                        window.innerHeight * (0.5 + Math.random() * 0.3)
                    );
                    
                    tile.style.width = `${startSize}px`;
                    tile.style.height = `${startSize}px`;
                    tile.style.transform = `rotate(${startRot}deg)`;
                    
                    const col = i % cols;
                    const row = Math.floor(i / cols);
                    const xVar = (Math.random() - 0.5) * 50;
                    const yVar = (Math.random() - 0.5) * 50;
                    
                    tile.style.left = `${(col * window.innerWidth/cols) - startSize/2 + xVar}px`;
                    tile.style.top = `${(row * window.innerHeight/rows) - startSize/2 + yVar}px`;
                    
                    dom.gifContainer.appendChild(tile);
                    
                    this.animateTile(tile, startRot);
                }
                
                setTimeout(() => {
                    dom.gifContainer.remove();
                }, 3500);
            },
            
            animateTile(tile, startRot) {
                requestAnimationFrame(() => {
                    const midSize = 40 + Math.random() * 80;
                    const midLeft = Math.random() * window.innerWidth;
                    const midTop = Math.random() * window.innerHeight;
                    const midRot = startRot + (-60 + Math.random() * 120);
                    
                    tile.style.width = `${midSize}px`;
                    tile.style.height = `${midSize}px`;
                    tile.style.left = `${midLeft}px`;
                    tile.style.top = `${midTop}px`;
                    tile.style.transform = `rotate(${midRot}deg)`;
                    
                    setTimeout(() => {
                        const angle = Math.random() * Math.PI * 2;
                        const distance = 200 + Math.random() * 400;
                        
                        tile.style.width = '0px';
                        tile.style.height = '0px';
                        tile.style.left = `${midLeft + Math.cos(angle) * distance}px`;
                        tile.style.top = `${midTop + Math.sin(angle) * distance}px`;
                    }, 1200 + Math.random() * 800);
                });
            },
            
            showHeroContent() {
                dom.mainContent.classList.add('visible');
                
                setTimeout(() => dom.mainTitle.classList.add('fade-in'), 500);
                setTimeout(() => dom.subtitle.classList.add('fade-in'), 1000);
                setTimeout(() => dom.ctaButton.classList.add('fade-in'), 1500);
            }
        };

        // 2. Video Toggle Module
        const videoController = {
            init() {
                dom.videoToggle.addEventListener('change', this.toggleVideos.bind(this));
                // Set initial theme
                document.documentElement.setAttribute('data-theme', 'default');
            },
            
            toggleVideos() {
                if (dom.videoToggle.checked) {
                    dom.video1.classList.replace('active', 'inactive');
                    dom.video2.classList.replace('inactive', 'active');
                    document.documentElement.setAttribute('data-theme', 'forest');
                } else {
                    dom.video2.classList.replace('active', 'inactive');
                    dom.video1.classList.replace('inactive', 'active');
                    document.documentElement.setAttribute('data-theme', 'default');
                }
            }
        };

        // 3. Navigation Module
        const navigation = {
            init() {
                this.setupEventListeners();
                this.setupSmoothScrolling();
                this.setupHeaderScrollEffect();
                this.setupBackToTopButton();
            },
            
            setupEventListeners() {
                dom.mobileMenuBtn.addEventListener('click', this.toggleMenu.bind(this));
                dom.menuOverlay.addEventListener('click', this.closeMenu.bind(this));
                
                document.addEventListener('click', (e) => {
                    if (e.target.matches('nav a')) {
                        this.closeMenu();
                    }
                });
            },
            
            toggleMenu() {
                dom.mobileMenuBtn.classList.toggle('active');
                dom.nav.classList.toggle('active');
                dom.menuOverlay.classList.toggle('active');
                dom.header.classList.toggle('active');
                document.body.style.overflow = dom.nav.classList.contains('active') ? 'hidden' : '';
                
                if (dom.nav.classList.contains('active')) {
                    const items = document.querySelectorAll('nav ul li');
                    items.forEach((item, i) => {
                        item.style.transitionDelay = `${0.1 * (i + 1)}s`;
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    });
                }
            },
            
            closeMenu() {
                dom.mobileMenuBtn.classList.remove('active');
                dom.nav.classList.remove('active');
                dom.menuOverlay.classList.remove('active');
                dom.header.classList.remove('active');
                document.body.style.overflow = '';
            },
            
            setupSmoothScrolling() {
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.querySelector(this.getAttribute('href')).scrollIntoView({
                            behavior: 'smooth'
                        });
                    });
                });
            },
            
            setupHeaderScrollEffect() {
                window.addEventListener('scroll', () => {
                    dom.header.classList.toggle('scrolled', window.scrollY > 50);
                });
            },
            
            setupBackToTopButton() {
                window.addEventListener('scroll', this.toggleBackToTopButton.bind(this));
                dom.backToTop.addEventListener('click', utils.scrollToTop);
            },
            
            toggleBackToTopButton() {
                if (window.pageYOffset > 300) {
                    dom.backToTop.classList.add('visible');
                } else {
                    dom.backToTop.classList.remove('visible');
                }
            }
        };

        // 4. Content Loader Module
        const contentLoader = {
            init() {
                this.setupEventListeners();
                this.loadInitialPosts();
                this.setupInfiniteScroll();
            },
            
            setupEventListeners() {
                dom.postsGrid.addEventListener('click', (e) => {
                    const readMoreLink = e.target.closest('.read-more');
                    if (!readMoreLink) return;
                    
                    e.preventDefault();
                    const postCard = readMoreLink.closest('.post-card');
                    const postId = postCard.dataset.id;
                    this.showSinglePost(postId);
                });
                
                dom.backToBlog.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showPostGrid();
                    utils.scrollToElement(document.getElementById('blog'));
                });
            },
            
            async loadInitialPosts() {
                try {
                    dom.postsLoading.classList.add('active');
                    utils.setLoading(dom.postsLoading, true);
                    
                    const postsQuery = db.collection('posts')
                        .orderBy('date', 'desc')
                        .limit(CONFIG.posts.perPage);
                    
                    const postsSnapshot = await postsQuery.get();
                    
                    this.processPostsSnapshot(postsSnapshot);
                    
                    if (postsSnapshot.docs.length < CONFIG.posts.perPage) {
                        state.hasMorePosts = false;
                    }
                } catch (error) {
                    console.error("Failed to load initial posts:", error);
                    utils.showError(dom.adminError, "Failed to load posts. Please try again later.");
                } finally {
                    dom.postsLoading.classList.remove('active');
                    utils.setLoading(dom.postsLoading, false);
                }
            },
            
            async loadMorePosts() {
                if (state.isLoadingPosts || !state.hasMorePosts) return;
                
                try {
                    state.isLoadingPosts = true;
                    dom.postsLoading.classList.add('active');
                    utils.setLoading(dom.postsLoading, true);
                    
                    let postsQuery = db.collection('posts')
                        .orderBy('date', 'desc')
                        .startAfter(state.lastVisiblePost)
                        .limit(CONFIG.posts.perPage);
                    
                    const postsSnapshot = await postsQuery.get();
                    
                    this.processPostsSnapshot(postsSnapshot);
                    
                    if (postsSnapshot.docs.length < CONFIG.posts.perPage) {
                        state.hasMorePosts = false;
                    }
                } catch (error) {
                    console.error("Failed to load more posts:", error);
                    utils.showError(dom.adminError, "Failed to load more posts. Please try again later.");
                } finally {
                    state.isLoadingPosts = false;
                    dom.postsLoading.classList.remove('active');
                    utils.setLoading(dom.postsLoading, false);
                }
            },
            
            processPostsSnapshot(postsSnapshot) {
                if (postsSnapshot.empty) {
                    state.hasMorePosts = false;
                    return;
                }
                
                state.lastVisiblePost = postsSnapshot.docs[postsSnapshot.docs.length - 1];
                
                const newPosts = postsSnapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        title: data.title,
                        date: utils.formatDate(data.date.toDate()),
                        readTime: data.readTime || '5 min read',
                        image: data.image || 'https://via.placeholder.com/400x250?text=No+Image',
                        tags: data.tags || [],
                        excerpt: data.excerpt || 'No content available',
                        content: data.content || ''
                    };
                });
                
                state.posts = [...state.posts, ...newPosts];
                this.renderPosts(state.posts);
            },
            
            renderPosts(posts) {
                if (posts.length === 0) {
                    dom.postsGrid.innerHTML = '<p class="no-posts">No posts found. Check back later!</p>';
                    return;
                }
                
                posts.forEach(post => {
                    const postEl = document.createElement('article');
                    postEl.className = 'post-card';
                    postEl.dataset.id = post.id;
                    postEl.innerHTML = `
                    <div class="post-image">
                        <img src="${post.image}" alt="${post.title}" loading="lazy">
                        <h3 class="post-title-overlay">${post.title}</h3>
                    </div>
                    <div class="post-content">
                        <div class="post-meta">
                            <span>${post.date}</span>
                        </div>
                        <div class="post-tags">
                            ${post.tags.map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                        </div>
                        <p class="post-excerpt">${post.excerpt}</p>
                        <a href="#" class="read-more">Continue Reading </a>
                    </div>
                    `;
                    dom.postsGrid.appendChild(postEl);
                });
            },
            
            async showSinglePost(postId) {
                try {
                    // Show loading state
                    dom.singlePostView.classList.add('loading');
                    dom.singlePostView.classList.add('active');
                    dom.postsGrid.style.display = 'none';
                    document.body.classList.add('single-post-active');
                    
                    const post = state.posts.find(p => p.id === postId) || await this.fetchSinglePost(postId);
                    
                    if (!post) {
                        throw new Error('Post not found');
                    }
                    
                    dom.singlePostContent.innerHTML = `
                        <div class="post-image">
                            <img src="${post.image}" alt="${post.title}" loading="lazy">
                        </div>
                        <div class="post-content">
                            <div class="post-meta">
                                <span>${post.date}</span>
                            </div>
                            <h1>${post.title}</h1>
                            <div class="post-tags">
                                ${post.tags.map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                            </div>
                            <div class="post-content-text">
                                ${post.content}
                            </div>
                        </div>
                    `;
                    
                    // Remove loading state and show content
                    dom.singlePostView.classList.remove('loading');
                    dom.backToBlog.classList.add('visible');
                    
                    // Scroll to the post after a short delay to allow rendering
                    setTimeout(() => {
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    }, 50);
                } catch (error) {
                    console.error("Failed to load single post:", error);
                    utils.showError(dom.adminError, "Failed to load post. Please try again later.");
                    this.showPostGrid();
                }
            },
            
            async fetchSinglePost(postId) {
                try {
                    const doc = await db.collection('posts').doc(postId).get();
                    
                    if (!doc.exists) {
                        throw new Error('Post not found');
                    }
                    
                    const data = doc.data();
                    const post = {
                        id: doc.id,
                        title: data.title,
                        date: utils.formatDate(data.date.toDate()),
                        readTime: data.readTime || '5 min read',
                        image: data.image || 'https://via.placeholder.com/400x250?text=No+Image',
                        tags: data.tags || [],
                        excerpt: data.excerpt || 'No content available',
                        content: data.content || ''
                    };
                    
                    state.posts.push(post);
                    return post;
                } catch (error) {
                    console.error("Error fetching single post:", error);
                    throw error;
                }
            },
            
            showPostGrid() {
                document.body.classList.remove('single-post-active');
                dom.singlePostView.classList.remove('active');
                dom.singlePostView.classList.remove('loading');
                dom.postsGrid.style.display = 'grid';
                dom.backToBlog.classList.remove('visible');
            },
            
            setupInfiniteScroll() {
                window.addEventListener('scroll', () => {
                    if (state.isLoadingPosts || !state.hasMorePosts) return;
                    
                    const scrollPosition = window.innerHeight + window.scrollY;
                    const threshold = document.body.offsetHeight - CONFIG.posts.loadThreshold;
                    
                    if (scrollPosition >= threshold) {
                        this.loadMorePosts();
                    }
                });
            }
        };

        // 5. Admin Panel Module
        const adminPanel = {
            currentPost: null,
            
            init() {
                this.setupEventListeners();
                this.setupFormattingToolbar();
                this.checkAuthState();
            },
            
            setupEventListeners() {
                dom.adminToggleBtn.addEventListener('click', this.toggleAdminPanel.bind(this));
                dom.adminPanelOverlay.addEventListener('click', this.toggleAdminPanel.bind(this));
                dom.loginBtn.addEventListener('click', this.handleLogin.bind(this));
                dom.logoutBtn.addEventListener('click', this.handleLogout.bind(this));
                dom.addPostBtn.addEventListener('click', () => {
                    this.showPostForm();
                    this.hidePostsList();
                });
                dom.savePostBtn.addEventListener('click', this.savePost.bind(this));
                dom.cancelPostBtn.addEventListener('click', () => {
                    this.hidePostForm();
                    this.showPostsList();
                });
                dom.deletePostBtn.addEventListener('click', this.deletePost.bind(this));
            },
            
            setupFormattingToolbar() {
                dom.formattingToolbar.addEventListener('click', (e) => {
                    if (e.target.classList.contains('formatting-button') && e.target.dataset.command) {
                        const command = e.target.dataset.command;
                        utils.formatText(command);
                        utils.toggleFormattingButton(e.target);
                    }
                });
                
                dom.alignmentPickerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    dom.alignmentOptions.style.display = dom.alignmentOptions.style.display === 'grid' ? 'none' : 'grid';
                    dom.sizeOptions.style.display = 'none';
                });
                
                dom.alignmentOptions.addEventListener('click', (e) => {
                    if (e.target.classList.contains('alignment-option')) {
                        const align = e.target.dataset.align;
                        const selection = window.getSelection();
                        if (selection.rangeCount > 0) {
                            const range = selection.getRangeAt(0);
                            const div = document.createElement('div');
                            div.className = `text-${align}`;
                            
                            if (!selection.isCollapsed) {
                                const selectedContent = range.extractContents();
                                div.appendChild(selectedContent);
                                range.insertNode(div);
                            } else {
                                const parentParagraph = range.startContainer.parentElement.closest('p, div');
                                if (parentParagraph) {
                                    parentParagraph.className = parentParagraph.className
                                        .split(' ')
                                        .filter(cls => !cls.startsWith('text-'))
                                        .join(' ');
                                    parentParagraph.classList.add(`text-${align}`);
                                }
                            }
                            
                            dom.postContentEditor.querySelectorAll('p:empty, div:empty').forEach(el => el.remove());
                        }
                        
                        dom.alignmentOptions.style.display = 'none';
                    }
                });
                
                dom.sizePickerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    dom.sizeOptions.style.display = dom.sizeOptions.style.display === 'flex' ? 'none' : 'flex';
                    dom.alignmentOptions.style.display = 'none';
                });
                
                dom.sizeOptions.addEventListener('click', (e) => {
                    if (e.target.classList.contains('size-option')) {
                        const size = e.target.dataset.size;
                        let fontSize;
                        
                        switch(size) {
                            case 'xs': fontSize = '0.8rem'; break;
                            case 'sm': fontSize = '0.9rem'; break;
                            case 'md': fontSize = '1.1rem'; break;
                            case 'lg': fontSize = '1.3rem'; break;
                            case 'xl': fontSize = '1.5rem'; break;
                            case 'xxl': fontSize = '1.8rem'; break;
                            default: fontSize = '1rem';
                        }
                        
                        utils.formatText('fontSize', '7');
                        document.execCommand('styleWithCSS', false, true);
                        document.execCommand('fontSize', false, '7');
                        document.execCommand('styleWithCSS', false, false);
                        
                        const selection = window.getSelection();
                        if (selection.rangeCount > 0) {
                            const range = selection.getRangeAt(0);
                            const span = document.createElement('span');
                            span.className = `text-${size}`;
                            range.surroundContents(span);
                        }
                        
                        dom.sizeOptions.style.display = 'none';
                    }
                });
                
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.alignment-picker') && !e.target.closest('.size-picker')) {
                        dom.alignmentOptions.style.display = 'none';
                        dom.sizeOptions.style.display = 'none';
                    }
                });
                
                dom.postContentEditor.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        document.execCommand('insertText', false, '\t');
                    }
                });
                
                dom.postContentEditor.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        const selection = window.getSelection();
                        if (selection.rangeCount > 0) {
                            const range = selection.getRangeAt(0);
                            const node = range.startContainer;
                            
                            if (node.nodeType === Node.TEXT_NODE && node.parentNode.nodeName === 'P') {
                                const text = node.textContent;
                                if (text.startsWith('\t')) {
                                    setTimeout(() => {
                                        const newParagraph = dom.postContentEditor.querySelector('p:last-child');
                                        if (newParagraph && newParagraph.textContent.startsWith('\t')) {
                                            newParagraph.textContent = newParagraph.textContent.replace(/^\t+/, '');
                                        }
                                    }, 0);
                                }
                            }
                        }
                    }
                });
            },
            
            toggleAdminPanel() {
                dom.adminPanelOverlay.classList.toggle('active');
                dom.adminPanelExpanded.classList.toggle('active');
                document.body.style.overflow = dom.adminPanelExpanded.classList.contains('active') ? 'hidden' : '';
            },
            
            async checkAuthState() {
                auth.onAuthStateChanged(user => {
                    if (user) {
                        this.showAdminControls();
                        this.loadPostsList();
                    } else {
                        this.showLoginForm();
                    }
                });
            },
            
            async handleLogin() {
                const email = dom.adminEmail.value.trim();
                const password = dom.adminPassword.value.trim();
                
                if (!email || !password) {
                    utils.showError(dom.loginError, "Please enter both email and password");
                    return;
                }
                
                try {
                    utils.setLoading(dom.loginBtn, true);
                    await auth.signInWithEmailAndPassword(email, password);
                    this.showAdminControls();
                    this.loadPostsList();
                    utils.showSuccess(dom.adminSuccess, "Login successful");
                } catch (error) {
                    console.error('Login error:', error);
                    let errorMessage = "Login failed. Please try again.";
                    
                    switch (error.code) {
                        case 'auth/user-not-found':
                            errorMessage = "User not found. Please check your email.";
                            break;
                        case 'auth/wrong-password':
                            errorMessage = "Incorrect password. Please try again.";
                            break;
                        case 'auth/invalid-email':
                            errorMessage = "Invalid email format.";
                            break;
                    }
                    
                    utils.showError(dom.loginError, errorMessage);
                } finally {
                    utils.setLoading(dom.loginBtn, false);
                }
            },
            
            async handleLogout() {
                try {
                    utils.setLoading(dom.logoutBtn, true);
                    await auth.signOut();
                    this.showLoginForm();
                    this.hidePostForm();
                    this.hidePostsList();
                    utils.showSuccess(dom.adminSuccess, "Logged out successfully");
                } catch (error) {
                    console.error('Logout error:', error);
                    utils.showError(dom.adminError, "Logout failed. Please try again.");
                } finally {
                    utils.setLoading(dom.logoutBtn, false);
                }
            },
            
            showAdminControls() {
                dom.loginForm.classList.add('hidden');
                dom.adminControls.classList.remove('hidden');
            },
            
            showLoginForm() {
                dom.adminControls.classList.add('hidden');
                dom.loginForm.classList.remove('hidden');
                dom.adminEmail.value = '';
                dom.adminPassword.value = '';
            },
            
            async loadPostsList() {
                try {
                    utils.setLoading(dom.postsListContainer, true);
                    const postsSnapshot = await db.collection('posts').orderBy('date', 'desc').get();
                    
                    if (postsSnapshot.empty) {
                        dom.postsList.innerHTML = '<tr><td colspan="3" style="text-align: center;">No posts found</td></tr>';
                        return;
                    }
                    
                    const posts = postsSnapshot.docs.map(doc => {
                        const data = doc.data();
                        return {
                            id: doc.id,
                            title: data.title,
                            date: utils.formatDate(data.date.toDate())
                        };
                    });
                    
                    this.renderPostsList(posts);
                    this.showPostsList();
                } catch (error) {
                    console.error("Failed to load posts list:", error);
                    utils.showError(dom.adminError, "Failed to load posts. Please try again later.");
                } finally {
                    utils.setLoading(dom.postsListContainer, false);
                }
            },
            
            renderPostsList(posts) {
                dom.postsList.innerHTML = '';
                
                posts.forEach(post => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${post.title}</td>
                        <td>${post.date}</td>
                        <td class="post-actions">
                            <button class="btn edit-post" data-id="${post.id}">Edit</button>
                            <button class="btn danger delete-post" data-id="${post.id}">Delete</button>
                        </td>
                    `;
                    dom.postsList.appendChild(row);
                });
                
                document.querySelectorAll('.edit-post').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.target.getAttribute('data-id');
                        this.editPost(postId);
                    });
                });
                
                document.querySelectorAll('.delete-post').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.target.getAttribute('data-id');
                        if (confirm('Are you sure you want to delete this post?')) {
                            this.deletePost(postId);
                        }
                    });
                });
            },
            
            showPostsList() {
                dom.postsListContainer.classList.remove('hidden');
                dom.postForm.classList.add('hidden');
            },
            
            hidePostsList() {
                dom.postsListContainer.classList.add('hidden');
            },
            
            async editPost(postId) {
                try {
                    utils.setLoading(dom.savePostBtn, true);
                    const doc = await db.collection('posts').doc(postId).get();
                    
                    if (!doc.exists) {
                        throw new Error('Post not found');
                    }
                    
                    const post = doc.data();
                    this.currentPost = { id: postId, ...post };
                    
                    dom.formTitle.textContent = 'Edit Post';
                    dom.postId.value = postId;
                    dom.postTitle.value = post.title;
                    dom.postContentEditor.innerHTML = post.content;
                    dom.postImage.value = post.image || '';
                    dom.postTags.value = post.tags ? post.tags.join(', ') : '';
                    
                    dom.deletePostBtn.style.display = 'inline-block';
                    
                    this.showPostForm();
                    this.hidePostsList();
                    
                    dom.adminPanelExpanded.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                } catch (error) {
                    console.error("Error loading post for editing:", error);
                    utils.showError(dom.postFormError, "Failed to load post for editing");
                } finally {
                    utils.setLoading(dom.savePostBtn, false);
                }
            },
            
            showPostForm() {
                if (!this.currentPost) {
                    dom.formTitle.textContent = 'Create New Post';
                    dom.postId.value = '';
                    dom.postTitle.value = '';
                    dom.postContentEditor.innerHTML = '';
                    dom.postImage.value = '';
                    dom.postTags.value = '';
                    dom.deletePostBtn.style.display = 'none';
                }
                
                dom.postForm.classList.remove('hidden');
                dom.postContentEditor.focus();
            },
            
            hidePostForm() {
                dom.postForm.classList.add('hidden');
                this.currentPost = null;
            },
            
            async savePost() {
                const title = dom.postTitle.value.trim();
                const content = dom.postContentEditor.innerHTML;
                const image = dom.postImage.value.trim();
                const tags = dom.postTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                if (!title || !content) {
                    utils.showError(dom.postFormError, "Title and content are required");
                    return;
                }
                
                const excerpt = this.createExcerpt(content);
                
                const postData = {
                    title: utils.sanitizeInput(title),
                    content: content,
                    excerpt: excerpt,
                    image: image,
                    tags: tags,
                    date: this.currentPost?.date ? this.currentPost.date : new Date()
                };
                
                try {
                    utils.setLoading(dom.savePostBtn, true);
                    
                    if (dom.postId.value) {
                        await db.collection('posts').doc(dom.postId.value).update(postData);
                        utils.showSuccess(dom.adminSuccess, "Post updated successfully");
                    } else {
                        await db.collection('posts').add(postData);
                        utils.showSuccess(dom.adminSuccess, "Post created successfully");
                    }
                    
                    this.loadPostsList();
                    contentLoader.loadInitialPosts();
                    
                    setTimeout(() => {
                        this.hidePostForm();
                        this.showPostsList();
                    }, 500);
                } catch (error) {
                    console.error('Error saving post:', error);
                    utils.showError(dom.postFormError, "Error saving post. Please try again.");
                } finally {
                    utils.setLoading(dom.savePostBtn, false);
                }
            },
            
            createExcerpt(content) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                let excerpt = tempDiv.textContent || tempDiv.innerText || '';
                excerpt = excerpt.substring(0, 150);
                
                if (excerpt.length === 150) {
                    excerpt += '...';
                }
                
                return excerpt;
            },
            
            async deletePost(postId = null) {
                const idToDelete = postId || dom.postId.value;
                if (!idToDelete) return;
                
                if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                    return;
                }
                
                try {
                    utils.setLoading(dom.deletePostBtn, true);
                    await db.collection('posts').doc(idToDelete).delete();
                    
                    utils.showSuccess(dom.adminSuccess, "Post deleted successfully");
                    this.loadPostsList();
                    contentLoader.loadInitialPosts();
                    this.hidePostForm();
                    this.showPostsList();
                } catch (error) {
                    console.error('Error deleting post:', error);
                    utils.showError(dom.adminError, "Error deleting post. Please try again.");
                } finally {
                    utils.setLoading(dom.deletePostBtn, false);
                }
            }
        };

        // ======================
        // Initialize Everything
        // ======================
        document.addEventListener('DOMContentLoaded', () => {
            preloader.init();
            videoController.init();
            navigation.init();
            contentLoader.init();
            adminPanel.init();
        });
    </script>
</body>
</html>
